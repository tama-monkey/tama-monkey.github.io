document.addEventListener('DOMContentLoaded',()=>{const NUM_PLAYERS_TO_INPUT=10;const playerInputsContainer=document.getElementById('player-inputs');const assignTeamsButton=document.getElementById('assignTeamsButton');const team1List=document.getElementById('team1-list');const team2List=document.getElementById('team2-list');const spectatorsList=document.getElementById('spectators-list');function saveNamesToSessionStorage(){if(!playerInputsContainer){console.error('Error: Player inputs container not found for saving to session storage!');return;}const inputElements=playerInputsContainer.getElementsByTagName('input');const namesArray=[];for(let i=0;i<inputElements.length;i++){namesArray.push(inputElements[i].value);}sessionStorage.setItem('teamAssignmentPlayerNames',JSON.stringify(namesArray));}function createPlayerInputs(){if(!playerInputsContainer){console.error('Error: Player inputs container not found!');return;}for(let i=0;i<NUM_PLAYERS_TO_INPUT;i++){const input=document.createElement('input');input.type='text';input.placeholder=`プレイヤー ${i+1}`;input.id=`player-name-${i+1}`;input.style.display='block';input.style.marginBottom='5px';input.addEventListener('input',saveNamesToSessionStorage);playerInputsContainer.appendChild(input);}loadNamesFromSessionStorage();}function loadNamesFromSessionStorage(){const savedNamesString=sessionStorage.getItem('teamAssignmentPlayerNames');if(savedNamesString){try{const savedNames=JSON.parse(savedNamesString);if(Array.isArray(savedNames)&&playerInputsContainer){const inputElements=playerInputsContainer.getElementsByTagName('input');for(let i=0;i<inputElements.length;i++){if(savedNames[i]!==undefined&&savedNames[i]!==null){inputElements[i].value=savedNames[i];}}}}catch(e){console.error('Error parsing saved player names from session storage:',e);}}}function loadAndDisplayTeamResults(){const resultsString=sessionStorage.getItem('teamAssignmentResults');if(resultsString){try{const results=JSON.parse(resultsString);if(!team1List||!team2List||!spectatorsList){console.error('Team list DOM elements not found for displaying results.');return;}team1List.innerHTML='';team2List.innerHTML='';spectatorsList.innerHTML='';if(results.team1&&Array.isArray(results.team1)){results.team1.forEach(name=>{const li=document.createElement('li');li.textContent=name;team1List.appendChild(li);});}if(results.team2&&Array.isArray(results.team2)){results.team2.forEach(name=>{const li=document.createElement('li');li.textContent=name;team2List.appendChild(li);});}if(results.spectators&&Array.isArray(results.spectators)){if(results.spectators.length>0){results.spectators.forEach(name=>{const li=document.createElement('li');li.textContent=name;spectatorsList.appendChild(li);});}else{const li=document.createElement('li');li.textContent='なし';spectatorsList.appendChild(li);}}}catch(e){console.error('Error parsing saved team results from session storage:',e);}}}function shuffleArray(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}}function handleTeamAssignment(){if(!playerInputsContainer||!team1List||!team2List||!spectatorsList){console.error('Error: One or more DOM elements for team assignment are missing!');return;}const inputElements=playerInputsContainer.getElementsByTagName('input');const playerNames=[];for(let i=0;i<inputElements.length;i++){const name=inputElements[i].value.trim();if(name){playerNames.push(name);}}if(playerNames.length<8){alert('少なくとも8名のプレイヤー名を入力してください。\n(Please enter at least 8 player names.)');return;}if(playerNames.length>NUM_PLAYERS_TO_INPUT){alert(`プレイヤー名の入力は最大${NUM_PLAYERS_TO_INPUT}名までです。\n(Maximum of ${NUM_PLAYERS_TO_INPUT}player names can be entered.)`);return;}shuffleArray(playerNames);team1List.innerHTML='';team2List.innerHTML='';spectatorsList.innerHTML='';const team1Players=playerNames.slice(0,4);const team2Players=playerNames.slice(4,8);const spectatorPlayers=playerNames.slice(8);team1Players.forEach(name=>{const li=document.createElement('li');li.textContent=name;team1List.appendChild(li);});team2Players.forEach(name=>{const li=document.createElement('li');li.textContent=name;team2List.appendChild(li);});if(spectatorPlayers.length>0){spectatorPlayers.forEach(name=>{const li=document.createElement('li');li.textContent=name;spectatorsList.appendChild(li);});}else{const li=document.createElement('li');li.textContent='なし';spectatorsList.appendChild(li);}const resultsToStore={team1: team1Players,team2: team2Players,spectators: spectatorPlayers};sessionStorage.setItem('teamAssignmentResults',JSON.stringify(resultsToStore));}if(assignTeamsButton){assignTeamsButton.addEventListener('click',handleTeamAssignment);}else{console.error('Error: Assign teams button not found!');}createPlayerInputs();loadAndDisplayTeamResults();});