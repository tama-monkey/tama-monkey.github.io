let randomButtonDisabledUntil=Date.now();const randomButton=document.getElementById('random-button');const stageDisplay=document.getElementById('stage-display');const cooldownTime=270000;loadStages();initializeState();updateButtonCooldown();randomButton.addEventListener('click',selectRandomStages);function loadStages(){const savedStages=sessionStorage.getItem('selectedStages');if(savedStages){const parsedStages=JSON.parse(savedStages);stageDisplay.innerHTML=`<p>1試合目: ${parsedStages[0]}</p><p>2試合目: ${parsedStages[1]}</p><p>3試合目: ${parsedStages[2]}</p>`;}}function initializeState(){const savedRandomButtonDisabledUntil=sessionStorage.getItem('randomButtonDisabledUntil');if(savedRandomButtonDisabledUntil){randomButtonDisabledUntil=parseInt(savedRandomButtonDisabledUntil,10);}}function selectRandomStages(){let selectedStages=[];while(selectedStages.length<3){const randomStage=stages[Math.floor(Math.random()*stages.length)];if(!selectedStages.includes(randomStage)){selectedStages.push(randomStage);}}stageDisplay.innerHTML=`<p>1試合目: ${selectedStages[0]}</p><p>2試合目: ${selectedStages[1]}</p><p>3試合目: ${selectedStages[2]}</p>`;sessionStorage.setItem('selectedStages',JSON.stringify(selectedStages));randomButtonDisabledUntil=Date.now()+cooldownTime;sessionStorage.setItem('randomButtonDisabledUntil',randomButtonDisabledUntil);updateButtonCooldown();}function updateButtonCooldown(){randomButton.disabled=true;const interval=setInterval(()=>{let seconds=Math.ceil((randomButtonDisabledUntil-Date.now())/1000);if(seconds>0){randomButton.disabled=true;randomButton.textContent=`再選択可能まで ${seconds}秒`;}else{clearInterval(interval);randomButton.disabled=false;randomButton.textContent='ランダムステージ選択';}},100);}